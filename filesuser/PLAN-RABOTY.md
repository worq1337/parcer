# –ü–ª–∞–Ω —Ä–∞–±–æ—Ç: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –±–æ—Ç–∞ —Å Telegram –∫–∞–Ω–∞–ª–æ–º –∏ –æ—Ç–ª–∞–¥–∫–∞

## –î–∞—Ç–∞: 26 –æ–∫—Ç—è–±—Ä—è 2025
## –í–µ—Ä—Å–∏—è: 1.0

---

## –¶–µ–ª–∏

1. **–î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ Telegram –∫–∞–Ω–∞–ª** - –±–æ—Ç –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª
2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å heartbeat —Å–æ–æ–±—â–µ–Ω–∏—è** - –∫–∞–∂–¥—ã–π —á–∞—Å –±–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ –∫–∞–Ω–∞–ª —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –≤—Å–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–æ
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω–Ω–µ–∫—Ç** - —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –ø–æ—á–µ–º—É –Ω–µ—Ç –Ω–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã:
1. **Backend (Node.js)** - `/backend/src/services/telegramBot.js`
   - –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —á–µ–∫–æ–≤
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–µ–∫—Å—Ç, —Ñ–æ—Ç–æ, PDF
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ PostgreSQL
   
2. **Userbot (Python/Telethon)** - `/services/userbot/userbot.py`
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –±–æ—Ç—ã
   - –ü–µ—Ä–µ—Å—ã–ª–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç
   
3. **OCR —Å–µ—Ä–≤–∏—Å** - `/services/ocr/app.py`
   - –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö

---

## –ó–∞–¥–∞—á–∞ 1: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram –∫–∞–Ω–∞–ª–æ–º

### 1.1. –°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫–∞–Ω–∞–ª

**–§–∞–π–ª:** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ Telegram

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π/–ø—É–±–ª–∏—á–Ω—ã–π Telegram –∫–∞–Ω–∞–ª –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∫–∞–Ω–∞–ª–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –ó–∞–ø–∏—Å–∞—Ç—å ID –∫–∞–Ω–∞–ª–∞ (–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ @userinfobot –∏–ª–∏ —á–µ—Ä–µ–∑ API)

### 1.2. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–Ω–∞–ª–∞

**–§–∞–π–ª:** `/backend/.env`

```env
# –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞:

# Telegram Channel Configuration
TELEGRAM_CHANNEL_ID=-1001234567890  # ID –≤–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å -100)
TELEGRAM_CHANNEL_ENABLED=true       # –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –≤ –∫–∞–Ω–∞–ª
```

### 1.3. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å telegramBot.js

**–§–∞–π–ª:** `/backend/src/services/telegramBot.js`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. –í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∫–ª–∞—Å—Å–∞ –¥–æ–±–∞–≤–∏—Ç—å:
```javascript
constructor() {
  this.bot = null;
  this.allowedUsers = [];
  this.channelId = null;          // –î–æ–±–∞–≤–∏—Ç—å
  this.channelEnabled = false;    // –î–æ–±–∞–≤–∏—Ç—å
  this.heartbeatInterval = null;  // –î–æ–±–∞–≤–∏—Ç—å –¥–ª—è —Ç–∞–π–º–µ—Ä–∞
}
```

2. –í –º–µ—Ç–æ–¥–µ `init()` –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–æ—Ç–∞ –¥–æ–±–∞–≤–∏—Ç—å:
```javascript
init() {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–Ω–∞–ª–∞
  if (process.env.TELEGRAM_CHANNEL_ID) {
    this.channelId = process.env.TELEGRAM_CHANNEL_ID;
    this.channelEnabled = process.env.TELEGRAM_CHANNEL_ENABLED === 'true';
    
    if (this.channelEnabled) {
      console.log(`‚úì –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –∫–∞–Ω–∞–ª –≤–∫–ª—é—á–µ–Ω–∞: ${this.channelId}`);
      this.startHeartbeat(); // –ó–∞–ø—É—Å–∫ heartbeat
    }
  }
  
  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
}
```

3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –∫–∞–Ω–∞–ª:
```javascript
/**
 * –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –∫–∞–Ω–∞–ª
 */
async sendToChannel(check) {
  if (!this.channelEnabled || !this.channelId || !this.bot) {
    return;
  }

  try {
    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∫–∞–Ω–∞–ª–∞
    const amountFormatted = this.formatAmount(Math.abs(check.amount));
    const sign = check.amount >= 0 ? '+' : '-';
    const emoji = check.amount >= 0 ? 'üíö' : 'üí∏';
    
    const message = `${emoji} **–ù–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è**\n\n` +
      `üìÖ –î–∞—Ç–∞: ${check.date_display} ${check.time_display}\n` +
      `üí∞ –°—É–º–º–∞: ${sign} ${amountFormatted} ${check.currency}\n` +
      `üè¶ –ë–∞–Ω–∫: ${check.operator || '–ù/–î'}\n` +
      `üí≥ –ö–∞—Ä—Ç–∞: \\*${check.card_last4}\n` +
      `üè™ –ü—Ä–æ–¥–∞–≤–µ—Ü: ${check.merchant || '–ù/–î'}\n` +
      `üìù –¢–∏–ø: ${check.transaction_type || '–ù/–î'}\n` +
      `üÜî ID —á–µ–∫–∞: \`${check.id}\`\n\n` +
      `_–ò—Å—Ç–æ—á–Ω–∏–∫: ${check.source || 'telegram\\_bot'}_`;

    await this.bot.sendMessage(this.channelId, message, {
      parse_mode: 'Markdown',
      disable_notification: false
    });

    console.log(`‚úì –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ${check.id} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –∫–∞–Ω–∞–ª`);
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –∫–∞–Ω–∞–ª:', error);
  }
}
```

4. –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥ –¥–ª—è heartbeat:
```javascript
/**
 * –ó–∞–ø—É—Å–∫ heartbeat - —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∂–¥—ã–π —á–∞—Å
 */
startHeartbeat() {
  if (this.heartbeatInterval) {
    clearInterval(this.heartbeatInterval);
  }

  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å—Ä–∞–∑—É
  this.sendHeartbeat();

  // –ó–∞—Ç–µ–º –∫–∞–∂–¥—ã–π —á–∞—Å (3600000 –º—Å = 1 —á–∞—Å)
  this.heartbeatInterval = setInterval(() => {
    this.sendHeartbeat();
  }, 3600000);

  console.log('‚úì Heartbeat –∑–∞–ø—É—â–µ–Ω (–∫–∞–∂–¥—ã–π —á–∞—Å)');
}

/**
 * –û—Ç–ø—Ä–∞–≤–∫–∞ heartbeat —Å–æ–æ–±—â–µ–Ω–∏—è
 */
async sendHeartbeat() {
  if (!this.channelEnabled || !this.channelId || !this.bot) {
    return;
  }

  try {
    const now = new Date().toLocaleString('ru-RU', {
      timeZone: 'Asia/Tashkent',
      day: '2-digit',
      month: '2-digit',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });

    const message = `‚úÖ **–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç**\n\n` +
      `üïê –í—Ä–µ–º—è: ${now} (–¢–∞—à–∫–µ–Ω—Ç)\n` +
      `üìä –°—Ç–∞—Ç—É—Å: –í—Å–µ —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç\n` +
      `üîÑ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–µ–Ω\n` +
      `‚ú® –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏\n\n` +
      `_–°–ª–µ–¥—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 1 —á–∞—Å_`;

    await this.bot.sendMessage(this.channelId, message, {
      parse_mode: 'Markdown',
      disable_notification: true // –ë–µ–∑ –∑–≤—É–∫–∞ —á—Ç–æ–±—ã –Ω–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å
    });

    console.log(`‚úì Heartbeat –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ ${now}`);
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ heartbeat:', error);
  }
}

/**
 * –û—Å—Ç–∞–Ω–æ–≤–∫–∞ heartbeat –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã
 */
stopHeartbeat() {
  if (this.heartbeatInterval) {
    clearInterval(this.heartbeatInterval);
    this.heartbeatInterval = null;
    console.log('‚úì Heartbeat –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
  }
}
```

5. –î–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ `sendToChannel` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏:

–í –º–µ—Ç–æ–¥–∞—Ö `handleTextMessage`, `handlePhotoMessage`, `handleDocumentMessage` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —á–µ–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å:
```javascript
// –ü–æ—Å–ª–µ if (ingestResponse.data.success) {
  const check = ingestResponse.data.data;
  const isDuplicate = ingestResponse.data.duplicate;

  if (!isDuplicate) {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –∫–∞–Ω–∞–ª
    await this.sendToChannel(check);  // –î–û–ë–ê–í–ò–¢–¨ –≠–¢–£ –°–¢–†–û–ö–£
  }
  
  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
}
```

6. –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥ `stop()`:
```javascript
stop() {
  this.stopHeartbeat();  // –î–û–ë–ê–í–ò–¢–¨ –≠–¢–£ –°–¢–†–û–ö–£
  
  if (this.bot) {
    this.bot.stopPolling();
    console.log('Telegram –±–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
  }
}
```

---

## –ó–∞–¥–∞—á–∞ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω–Ω–µ–∫—Ç–∞

### 2.1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ userbot

**–§–∞–π–ª:** `/services/userbot/userbot.py`

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ userbot –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —É–∫–∞–∑–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ ID –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –±–æ—Ç–æ–≤ –≤ `TELEGRAM_MONITOR_IDS`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `OUR_BOT_ID` —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```bash
# –ó–∞–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä userbot (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Docker)
docker exec -it userbot_container bash

# –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ API
curl http://localhost:5001/status
```

### 2.2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–§–∞–π–ª:** `/backend/.env`

–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
```env
TELEGRAM_BOT_TOKEN=8482297276:AAFVpe08Qua3xYUobf0CHpSERK7TdZRaSiE
TELEGRAM_MONITOR_IDS=915326936,856264490,7028509569
OUR_BOT_ID=8482297276
USERBOT_SERVICE_URL=http://localhost:5001
```

### 2.3. –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª:** `/backend/src/services/telegramBot.js`

–í –º–µ—Ç–æ–¥ `handleTextMessage` (—Å—Ç—Ä–æ–∫–∞ ~260) –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏:
```javascript
async handleTextMessage(msg) {
  const chatId = msg.chat.id;
  const userId = msg.from.id;
  const text = msg.text;

  // –î–û–ë–ê–í–ò–¢–¨ –õ–û–ò–ì–†–û–í–ê–ù–ò–ï
  console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
  console.log('üì® –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ:');
  console.log(`   User ID: ${userId}`);
  console.log(`   Chat ID: ${chatId}`);
  console.log(`   Text length: ${text.length}`);
  console.log(`   First 100 chars: ${text.substring(0, 100)}`);
  console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');

  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
}
```

**–§–∞–π–ª:** `/services/userbot/userbot.py`

–í –º–µ—Ç–æ–¥ `handle_new_message` (—Å—Ç—Ä–æ–∫–∞ ~251) —É–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```python
async def handle_new_message(self, event):
    try:
        sender = await event.get_sender()
        
        # –õ–æ–≥–∏—Ä—É–µ–º –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        print(f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ")
        print(f"üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ:")
        print(f"   –û—Ç: {sender.first_name if hasattr(sender, 'first_name') else 'Unknown'}")
        print(f"   ID –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è: {sender.id if hasattr(sender, 'id') else 'Unknown'}")
        print(f"   –¢–∏–ø: {type(sender).__name__}")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –æ–¥–Ω–∏–º –∏–∑ –º–æ–Ω–∏—Ç–æ—Ä–∏–º—ã—Ö –±–æ—Ç–æ–≤
        if isinstance(sender, User) and sender.id in config.MONITOR_BOT_IDS:
            print(f"‚úÖ –≠—Ç–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–º—ã–π –±–æ—Ç!")
            # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ø–µ—Ä–µ—Å—ã–ª–∫–∏ ...
        else:
            print(f"‚ùå –≠—Ç–æ –ù–ï –º–æ–Ω–∏—Ç–æ—Ä–∏–º—ã–π –±–æ—Ç (ID: {sender.id if hasattr(sender, 'id') else 'Unknown'})")
            print(f"   –û–∂–∏–¥–∞–µ–º—ã–µ ID: {config.MONITOR_BOT_IDS}")
        
        print(f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")
```

### 2.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é –≤ –±–æ—Ç–∞:
```
Karta: *1234
Summa: 100.00 UZS
Sana: 26.10.2025 15:30
Merchant: Test Shop
```

2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend:
```bash
# –ï—Å–ª–∏ Docker
docker logs -f backend_container

# –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
npm run dev
```

3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ userbot:
```bash
# –ï—Å–ª–∏ Docker  
docker logs -f userbot_container

# –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
cd services/userbot && python app.py
```

### 2.5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —á–µ–∫–∏
SELECT id, date, time, amount, currency, operator, source, created_at
FROM checks
ORDER BY created_at DESC
LIMIT 10;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–∫–æ–≤ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
SELECT source, COUNT(*) as count
FROM checks
GROUP BY source
ORDER BY count DESC;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
SELECT COUNT(*) as checks_today
FROM checks
WHERE created_at >= NOW() - INTERVAL '24 hours';
```

---

## –ó–∞–¥–∞—á–∞ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 3.1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –∫–∞–Ω–∞–ª

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] –°–æ–∑–¥–∞–Ω Telegram –∫–∞–Ω–∞–ª
- [ ] –ë–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∫–∞–Ω–∞–ª–∞
- [ ] ID –∫–∞–Ω–∞–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.env`
- [ ] –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —á–µ–∫ –≤ –±–æ—Ç–∞
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —á–µ–∫ –ø–æ—è–≤–∏–ª—Å—è –≤ –∫–∞–Ω–∞–ª–µ
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### 3.2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ heartbeat

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª–µ –ø–æ—è–≤–∏–ª–æ—Å—å –ø–µ—Ä–≤–æ–µ heartbeat —Å–æ–æ–±—â–µ–Ω–∏–µ
- [ ] –ü–æ–¥–æ–∂–¥–∞—Ç—å 5-10 –º–∏–Ω—É—Ç –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤ –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ "Heartbeat –∑–∞–ø—É—â–µ–Ω"
- [ ] –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å 3600000 –Ω–∞ 60000 (1 –º–∏–Ω—É—Ç–∞)
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ heartbeat –ø—Ä–∏—Ö–æ–¥–∏—Ç –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
- [ ] –í–µ—Ä–Ω—É—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –Ω–∞ 3600000

### 3.3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ userbot ‚Üí –±–æ—Ç ‚Üí –∫–∞–Ω–∞–ª

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
1. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ userbot –∑–∞–ø—É—â–µ–Ω –∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ–¥–∏–Ω –∏–∑ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –±–æ—Ç–æ–≤ (–∏–∑ `TELEGRAM_MONITOR_IDS`)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ userbot - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø–∏—Å—å –æ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏ –ø–µ—Ä–µ—Å—ã–ª–∫–µ
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞ - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø–∏—Å—å –æ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–Ω–∞–ª - –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

---

## –ó–∞–¥–∞—á–∞ 4: –û—Ç–ª–∞–¥–∫–∞ "–Ω–µ—Ç –Ω–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π"

### 4.1. –ß–µ–∫-–ª–∏—Å—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ:**

- [ ] **Userbot —Ä–∞–±–æ—Ç–∞–µ—Ç?**
  ```bash
  curl http://localhost:5001/status
  # –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: {"running": true, "authorized": true}
  ```

- [ ] **Userbot –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω?**
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ —Å–µ—Å—Å–∏–∏ –≤ `/services/userbot/sessions/`
  - –ï—Å–ª–∏ –Ω–µ—Ç - –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ª–æ–≥–∏–Ω —á–µ—Ä–µ–∑ API

- [ ] **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ ID –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –±–æ—Ç–æ–≤?**
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `TELEGRAM_MONITOR_IDS` –≤ `.env`
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –±–æ—Ç–∞
  - –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ID –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è

- [ ] **–û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è?**
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é –≤ –±–æ—Ç–∞
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∞

- [ ] **OCR —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç?**
  ```bash
  curl http://localhost:5000/health
  # –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: {"status": "ok"}
  ```

- [ ] **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞?**
  ```bash
  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
  psql -h localhost -p 5433 -U postgres -d receipt_parser -c "SELECT COUNT(*) FROM checks;"
  ```

### 4.2. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| Userbot –Ω–µ –∑–∞–ø—É—â–µ–Ω | `cd services/userbot && python app.py` |
| Userbot –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω | POST –∑–∞–ø—Ä–æ—Å –Ω–∞ `/login` —Å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞ |
| –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ ID –±–æ—Ç–æ–≤ | –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ ID —á–µ—Ä–µ–∑ @userinfobot |
| –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å TELEGRAM_BOT_TOKEN, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å |
| OCR –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | `cd services/ocr && python app.py` |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä PostgreSQL |

---

## –ó–∞–¥–∞—á–∞ 5: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 5.1. –°–æ–∑–¥–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∫–∞–Ω–∞–ª–∞

**–§–∞–π–ª:** `/docs/CHANNEL-SETUP.md`

–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:
1. –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å Telegram –∫–∞–Ω–∞–ª
2. –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å ID –∫–∞–Ω–∞–ª–∞
3. –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª
4. –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞ –±–æ—Ç–∞
5. –ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –≤ `.env`

### 5.2. –û–±–Ω–æ–≤–∏—Ç—å README.md

–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª:
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞–Ω–∞–ª–æ–º
- Heartbeat –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- Troubleshooting

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—Å–¥–µ–ª–∞—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å):
1. ‚úÖ –ó–∞–¥–∞—á–∞ 2.1-2.4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω–Ω–µ–∫—Ç–∞ userbot
2. ‚úÖ –ó–∞–¥–∞—á–∞ 2.5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
3. ‚úÖ –ó–∞–¥–∞—á–∞ 4: –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ "–Ω–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π"

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã):
1. ‚úÖ –ó–∞–¥–∞—á–∞ 1.1-1.2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–Ω–∞–ª–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
2. ‚úÖ –ó–∞–¥–∞—á–∞ 1.3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –∫–∞–Ω–∞–ª
3. ‚úÖ –ó–∞–¥–∞—á–∞ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–∫–æ–≥–¥–∞ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç):
1. ‚úÖ –ó–∞–¥–∞—á–∞ 5: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á:

1. **Userbot** —Å—Ç–∞–±–∏–ª—å–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –±–æ—Ç—ã –∏ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
2. **–û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è (—Ç–µ–∫—Å—Ç, —Ñ–æ—Ç–æ, PDF)
3. **–í—Å–µ —É—Å–ø–µ—à–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π Telegram –∫–∞–Ω–∞–ª
4. **–ö–∞–∂–¥—ã–π —á–∞—Å** –≤ –∫–∞–Ω–∞–ª –ø—Ä–∏—Ö–æ–¥–∏—Ç heartbeat —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–∞–±–æ—Ç–µ —Å–∏—Å—Ç–µ–º—ã
5. **–õ–æ–≥–∏** –¥–µ—Ç–∞–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
6. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ - –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å!

---

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

- **26.10.2025** - –ü–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è –ø–ª–∞–Ω–∞ —Ä–∞–±–æ—Ç
